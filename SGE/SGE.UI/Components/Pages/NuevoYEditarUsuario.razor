@page "/usuario/{Id:int?}"
@rendermode InteractiveServer
@inject CasoDeUsoUsuarioConsultaPorId consultarUsuario
@inject CasoDeUsoUsuarioModificacion modificarUsuario
@inject CasoDeUsoUsuarioAlta usuarioAlta
@inject NavigationManager Navegador
@inject Logger log

@if (log.Logueado && (log.IdUsuario == 1))
{
    @if (_esNuevoUsuario)
    {
        <h3 class="text-primary">Agregando un nuevo Usuario</h3>
    }
    else
    {
        <h3 class="text-primary">Modificando al Usuario "@u.Id"</h3>
    }

    <div class="container mt-4">
        <div class="row mb-3">
            <div class="col-md-6">
                <label for="nombre" class="form-label">Nombre</label>
                <input id="nombre" placeholder="Nombre" @bind="u.Nombre" class="form-control" />
            </div>
            <div class="col-md-6">
                <label for="apellido" class="form-label">Apellido</label>
                <input id="apellido" placeholder="Apellido" @bind="u.Apellido" class="form-control" />
            </div>
        </div>

        <div class="row mb-3">
            <div class="col-md-6">
                <label for="correo" class="form-label">Correo Electrónico</label>
                <input id="correo" type="email" placeholder="Correo Electrónico" @bind="u.CorreoElectronico" class="form-control" />
            </div>
            <div class="col-md-6">
                <label for="contraseña" class="form-label">Contraseña</label>
                <input id="contraseña" type="password" placeholder="Contraseña" @bind="u.Contraseña" class="form-control" />
            </div>
        </div>

        <div class="row">
            <div class="col-12">
                <button class="btn btn-primary" @onclick="Aceptar">Aceptar</button>
            </div>
        </div>
    </div>
}
else 
{
    <h3 class="text-danger text-center">Usted no esta logueado o no puede acceder</h3>
}

<style>
    .container {
        max-width: 600px;
        margin: auto;
        padding: 20px;
        border: 1px solid #ddd;
        border-radius: 8px;
        background-color: #f9f9f9;
    }
    h3 {
        text-align: center;
    }
    .form-label {
        font-weight: bold;
    }
    .form-control {
        box-shadow: none;
        border-radius: 4px;
    }
    .btn-primary {
        display: block;
        width: 100%;
        padding: 10px;
        font-size: 16px;
    }
</style>

@code {
    Usuario u = new Usuario();
    [Parameter] public int? Id {get; set; }
    bool _esNuevoUsuario = true;
    protected override void OnParametersSet()
    {
        if(Id != null)
        {
           var u_hallado = consultarUsuario.Ejecutar(Id.Value);
           if (u_hallado != null)
           {
               u = u_hallado;
               _esNuevoUsuario = false;
           }
        }
    }

    void Aceptar()
    {
        if (_esNuevoUsuario)
        {
            usuarioAlta.Ejecutar(u);
        }
        else
        {
            modificarUsuario.Ejecutar(u);
        }
        u = new Usuario();
        Navegador.NavigateTo("listarUsuarios");
    }
}
